{% extends "base.html" %}

{% block lab %}Лабораторная работа 8 - Статьи{% endblock %}

{% block main %}
    <h1>Статьи</h1>

    <form method="GET" action="/lab8/articles" style="margin: 20px 0;">
        <input type="text" name="search" 
               placeholder="Поиск по статьям..." 
               value="{{ search_query }}"
               style="padding: 10px; width: 300px; border: 1px solid #ddd; border-radius: 5px;">
        <button type="submit" style="padding: 10px 15px; background-color: #6a11cb; color: white; border: none; border-radius: 5px; cursor: pointer;">
            Поиск
        </button>
        {% if search_query %}
            <a href="/lab8/articles" style="margin-left: 10px; color: #666; text-decoration: none;">
                Сбросить поиск
            </a>
        {% endif %}
    </form>

    {% if current_user.is_authenticated %}
        <div style="margin: 20px 0;">
            <a href="/lab8/create" style="padding: 10px 15px; background-color: #4CAF50; color: white; text-decoration: none; border-radius: 5px;">
                Создать новую статью
            </a>
        </div>
    {% endif %}

    {% if search_query %}
        <div style="margin: 10px 0; padding: 10px; background-color: #e7f3ff; border-radius: 5px;">
            Результаты поиска по запросу: <strong>"{{ search_query }}"</strong>
        </div>
    {% endif %}

    <!-- Flash сообщения -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div style="margin-bottom: 20px;">
                {% for category, message in messages %}
                    <div style="padding: 10px; border-radius: 5px; margin-bottom: 5px; 
                                background-color: {% if category == 'success' %}#e8f5e9{% elif category == 'error' %}#ffebee{% elif category == 'warning' %}#fff8e1{% else %}#e3f2fd{% endif %}; 
                                color: {% if category == 'success' %}#2e7d32{% elif category == 'error' %}#c62828{% elif category == 'warning' %}#ff8f00{% else %}#1565c0{% endif %};">
                        {{ message }}
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    {% if articles %}
        <div style="display: flex; flex-direction: column; gap: 20px;">
            {% for article in articles %}
                <div style="border: 1px solid #ddd; padding: 20px; border-radius: 5px; background-color: white; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    <div style="display: flex; justify-content: space-between; align-items: start;">
                        <h3 style="margin-top: 0; color: #333; flex: 1;">{{ article.title }}</h3>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            {% if article.is_public %}
                                <span style="background-color: #4CAF50; color: white; padding: 3px 8px; border-radius: 10px; font-size: 0.8em;">
                                    Публичная
                                </span>
                            {% else %}
                                <span style="background-color: #f44336; color: white; padding: 3px 8px; border-radius: 10px; font-size: 0.8em;">
                                    Приватная
                                </span>
                            {% endif %}
                            {% if article.is_favorite %}
                                <span style="background-color: #FF9800; color: white; padding: 3px 8px; border-radius: 10px; font-size: 0.8em;">
                                    Избранная
                                </span>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div style="color: #666; margin-bottom: 15px; line-height: 1.5;">
                        {% if article.article_text|length > 300 %}
                            {{ article.article_text[:300] }}...
                        {% else %}
                            {{ article.article_text }}
                        {% endif %}
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; align-items: center; color: #888; font-size: 0.9em; border-top: 1px solid #eee; padding-top: 10px;">
                        <div>
                            Статья #{{ article.id }} • 
                            Лайков: <span style="color: #e91e63;">❤️ {{ article.likes }}</span>
                        </div>
                        
                        <div style="display: flex; gap: 10px;">
                            {% if current_user.is_authenticated %}
                                {% if article.login_id == current_user.id %}
                                    <a href="/lab8/edit/{{ article.id }}" 
                                       style="color: #2196F3; text-decoration: none; padding: 5px 10px; border: 1px solid #2196F3; border-radius: 3px;">
                                        Редактировать
                                    </a>
                                    <form action="/lab8/delete/{{ article.id }}" method="POST" style="display: inline;">
                                        <button type="submit" 
                                                onclick="return confirm('Вы уверены, что хотите удалить эту статью?')"
                                                style="color: #f44336; background: none; border: 1px solid #f44336; border-radius: 3px; padding: 5px 10px; cursor: pointer;">
                                            Удалить
                                        </button>
                                    </form>
                                {% else %}
                                    <form action="/lab8/like/{{ article.id }}" method="POST" style="display: inline;">
                                        <button type="submit" 
                                                style="padding: 5px 10px; background-color: #9C27B0; color: white; border: none; border-radius: 3px; cursor: pointer;">
                                            ❤️ Лайк
                                        </button>
                                    </form>
                                {% endif %}
                            {% else %}
                                <span style="color: #666;">Авторизуйтесь, чтобы взаимодействовать со статьями</span>
                            {% endif %}
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div style="text-align: center; padding: 40px; background-color: #f9f9f9; border-radius: 5px; margin: 20px 0;">
            {% if search_query %}
                <p>По запросу "{{ search_query }}" ничего не найдено.</p>
                <p>Попробуйте изменить поисковый запрос.</p>
            {% else %}
                <p>Статей пока нет</p>
                {% if not current_user.is_authenticated %}
                    <p>Войдите в систему, чтобы создавать статьи</p>
                    <a href="/lab8/login" style="display: inline-block; margin-top: 10px; padding: 8px 16px; background-color: #4CAF50; color: white; text-decoration: none; border-radius: 5px;">
                        Войти
                    </a>
                {% endif %}
            {% endif %}
        </div>
    {% endif %}

    <div style="margin-top: 30px; text-align: center;">
        <a href="/lab8" style="color: #666; text-decoration: none;">На главную</a>
    </div>
{% endblock %}